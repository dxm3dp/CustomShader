# 基础纹理

2020.3.22(7) 3.31(2)

纹理最初的目的就是使用一张图片来控制模型的外观 . 使用**纹理映射**技术 , 我们可以把一张图"黏"在模型表面 , 逐 **纹素(texel)** 地控制模型的颜色 .

美术人员在建模的时候 , 通常会在建模软件中利用纹理展开技术把**纹理坐标**存储在每个顶点上 . 纹理坐标定义了该顶点在纹理中对应的 2D 坐标 . 通常 , 这些坐标使用一个二维变量 ( u , v ) 来表示 , 其中 u 是横向坐标 , v 是纵向坐标 . 因此 , 纹理坐标也被称为 UV 坐标 .

尽管纹理的大小可以是多种多样的 , 例如 256 \* 256 或者 1024 \* 1024 , 但顶点 UV 坐标的范围通常都被归一化到 [ 0 , 1 ] 范围内. 需要注意的是 , 在纹理采样时使用的纹理坐标不一定是在 [ 0 , 1 ] 范围内 . 实际上 , 这种不在 [ 0 , 1 ] 范围内的纹理坐标有时会非常有用 . 与之关系紧密的是纹理的平铺模式 , 它将决定渲染引擎在遇到不在 [ 0 , 1 ] 范围内的纹理坐标时如何进行纹理采样 .

## 单张纹理

我们通常会使用一张纹理来代替物体的漫反射颜色 .

### 纹理的属性

在我们向 Unity 中导入一张纹理资源后 , 可以在它的材质面板上调整其属性 . 纹理面板上的第一个属性是纹理类型 . 在本节中 , 我们使用的是 `Texture` 类型 , 在下面的法线纹理一节中 , 我们会使用 `Normal map` 类型 . 而在后面的章节中 , 我们还会看到 `Cube map` 等高级纹理类型 . 我们之所以要为导入的纹理选择合适的类型 , 是因为只有这样才能让 Unity 知道我们的意图 , 为 Unity Shader 传递正确的纹理 , 并在一些情况下可以让 Unity 对该纹理进行优化 .

`Wrop Mode` 属性 , 它决定了当纹理坐标超过 [ 0 , 1 ] 范围后将会如何被平铺 .

- Repeat 模式

  在这种模式下 , 如果纹理坐标超过了 1 , 那么它的整数部分将会被舍弃 , 而直接使用小数部分进行采样 . 这样的结果是纹理将会不断重复 .

- Clamp 模式

  在这种模式下 , 如果纹理坐标大于 1 , 那么将会截取到 1 , 如果小于 0 , 那么将会截取到 0 .

`Filter Mode` 属性 , 它决定了当纹理由于变换而产生拉伸时将会采用哪种滤波模式 . `Filter Mode` 支持 3 种模式 : `Point` , `Bilinear` 以及 `Trilinear` . 它们得到的图片滤波效果依次提示 , 但需要耗费的性能也依次增大 .

纹理缩小的过程比放大更加复杂一些 , 此时原纹理中的多个像素将会对应一个目标像素 . 纹理缩小更加复杂的原因在于我们往往需要处理抗锯齿的问题 . 一个最常使用的方法就是**多级渐远纹理( mipmapping )** 技术 . 多级渐远纹理技术将原纹理提前用滤波处理来得到很多更小的图像 , 形成了一个图像金字塔 , 每一层都是对上一层降采样的结果 . 这样在实时运行时 , 就可以快速得到结果像素 . 但缺点是需要使用一定的空间用于存储这些多级渐远纹理 . 这是一种典型的用空间换时间的方法 .

在 Unity 中 , 我们可以在纹理导入面板中 , 首先将纹理类型选择成 `Advanced` , 再勾选 `Generate Mip Maps` 即可开启多级渐远纹理技术 .

最后 , 我们来讲一下纹理的最大尺寸和纹理模式 . 当我们为不同平台发布游戏时 , 需要考虑目标平台的纹理尺寸和质量问题 . **Unity 允许我们为不同目标平台选择不同的分辨率**.

如果导入的纹理大小超过了 `Max Texture Size` 中的设置值 , 那么 Unity 将会把该纹理缩放为这个最大分辨率 . 理想情况下 , 导入的纹理可以是非正方形的 , 但长宽的大小应该是 2 的幂 , 例如 2 4 8 16 32 64 等 . 如果使用了非 2 的幂大小的纹理 , 那么这些纹理往往会占用更多的内存空间 , 而且 GPU 读取该纹理的速度也会有所下降 . 有一些平台甚至不支持这种 NPOT ( Non Power of Two ) 纹理 , 这时 Unity 会在内部把它缩放成最近的 2 的幂大小 . 出于性能和空间考虑 , 我们应该尽量使用 2 的幂大小的纹理 .
