# ShaderLab 的混合命令

2020.4.22(3)

在本节 , 我们将更加详细地了解混合中的细节问题 .

我们首先来看一下混合是如何实现的 . 当片元着色器产生一个颜色的时候 , 可以选择与颜色缓存中的颜色进行混合 . 这样一来 , 混合就和两个操作数有关 : **源颜色** 和 **目标颜色** . 源颜色 , 我们用 $S$ 表示 , 指的是由片元着色器产生的颜色值 ; 目标颜色 , 我们用 $D$ 表示 , 指的是从颜色缓冲中读取到的颜色值 . 对它们进行混合后得到的输出颜色 , 我们用 $O$ 表示 , 它会重新写入到颜色缓冲中 . 需要注意的是 , 当我们谈及混合中的源颜色 , 目标颜色和输出颜色时 , 它们都包含了 RGBA 四个通道的值 , 而并非只是 RGB 通道 .

## 混合等式和参数

混合是一个逐片元的操作 , 而且它是不可编程的 , 但却是高度可配置的 . 也就是说 , 我们可以设置混合时使用的运算操作 , 混合因子等来影响混合 . 那么 , 这些配置又是如何实现的呢 ?

现在 , 我们已知两个操作数 : 源颜色 $S$ 和 目标颜色 $D$ , 想要得到输出颜色 $O$ 就必须使用一个等式来计算 . 我们把这个等式称为 **混合等式** . 当进行混合时 , 我们实际上设置的就是混合等式中的**操作**和**因子** . 在默认情况下 , 混合等式使用的操作都是加操作 , 我们只需要再设置一下混合因子即可 . 由于需要两个等式 ( 分别用于混合 RGB 通道和 A 通道 ) , 每个等式有两个因子 ( 一个用于和源颜色相乘 , 一个用于和目标颜色相乘 ) , 因此一共需要 4 个因子 . 下面就是使用这些因子进行加法混合时使用的混合公式 :

$$
O_{rgb} = SrcFactor \times S_{rgb} + DstFactor \times D_{rgb} \\
O_a = SrcFactorA \times S_{rgb} + DstFactorA \times D_a
$$

那么, 这些混合因子可以有哪些值呢 ? 下面给出 ShaderLab 支持的几种混合因子 :

- One . 因子为 1 .
- Zero . 因子为 0 .
- SrcColor . 因子为源颜色值 . 当用于混合 RGB 的混合等式时 , 使用 SrcColor 的 RGB 分量作为混合因子 ; 当用于混合 A 的混合等式时 , 使用 SrcColor 的 A 分量作为混合因子 .
- SrcAlpha . 因子为源颜色的透明度值 ( A 通道 ) .
- DstColor . 因子为目标颜色值 . 当用于混合 RGB 通道的混合等式时 , 使用 DstColor 的 RGB 分量作为混合因子 ; 当用于混合 A 通道的混合等式时 , 使用 DstColor 的 A 分量作为混合因子 .
- DstAlpha . 因子为目标颜色的透明度值 ( A 通道 ) .

## 混合操作

在上面涉及的混合等式中 , 当把源颜色和目标颜色与它们对应的混合因子相乘后 , 我们都是把它们的结果加起来作为输出颜色的 . 那么可不可以选择不使用加法 , 而使用减法呢 ? 答案是肯定的 , 我们可以使用 ShaderLab 的 `BlendOp BlendOperation` 命令 , 即混合操作命令 .
